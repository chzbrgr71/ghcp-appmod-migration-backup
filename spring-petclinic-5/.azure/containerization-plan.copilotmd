# **Containerization Plan**

## **Goal**
Setup Dockerfiles for the Spring PetClinic project to run inside of containers. Do not set up docker-compose for running locally as it is not required.

## **List of services to be containerized**

### Service: Spring PetClinic Application
**Location:** `/Users/brianredmond/source/migration-demo/spring-petclinic-4`

**Description:**
- **Language:** Java (Spring Boot 4.0.0-M3)
- **Java Version:** Requires Java 25 for build, runs on Java 17+
- **Framework:** Spring Boot with Spring MVC, Spring Data JPA, Thymeleaf
- **Build Tool:** Maven (pom.xml) with Gradle alternative available
- **Entry Point:** `org.springframework.samples.petclinic.PetClinicApplication`
- **Port:** 8080 (default Spring Boot port)
- **Database:** H2 (default), with support for MySQL and PostgreSQL
- **Dependencies:**
  - Spring Cloud Azure (5.22.0)
  - Webjars (Bootstrap, Font Awesome)
  - Spring Boot Actuator

## **Execution Steps**

> **Below are the steps for Copilot to follow; ask Copilot to update or execute this plan.**

### Steps to containerize the project:

1. ✅ **Check containerization pre-requisites:**
    1. ✅ Docker is installed and running (version verified)

2. ✅ **Scan the repository using tool 'appmod-analyze-repository':**
    - ✅ Analyzed the project structure and detected technologies
    - ✅ Identified Maven as build system, Spring Boot 4.0.0-M3 framework
    - ✅ Determined entry point: org.springframework.samples.petclinic.PetClinicApplication
    - ✅ Confirmed port: 8080

3. ✅ **Check code is ready to run in a local container:**
    1. ✅ Application already uses environment variables for configuration:
       - PostgreSQL: `POSTGRES_URL`, `POSTGRES_USER` with Azure Managed Identity support
       - MySQL: `MYSQL_URL`, `MYSQL_USER`, `MYSQL_PASS`
       - Default: H2 in-memory database (no external dependencies)
    2. ✅ Cloud dependencies identified:
       - **Optional**: Azure Managed Identity for PostgreSQL passwordless authentication
       - **Optional**: MySQL or PostgreSQL database (H2 embedded works for local testing)
    3. ✅ Database configuration can be overridden via Spring profiles and environment variables

4. ✅ **Create a Dockerfile for the project:**
    1. ✅ Generated Dockerfile guidance using 'appmod-plan-generate-dockerfile'
    2. ✅ Created production-ready multi-stage Dockerfile
    3. ✅ Implemented Spring Boot best practices:
       - Multi-stage build (build with JDK 25, run with JRE 17)
       - Non-root user for security
       - Health check using Spring Boot Actuator
       - Optimized layer caching with dependency pre-download

5. ✅ **Build the Docker image:**
    1. ✅ Successfully built Docker image with tag `spring-petclinic:4.0.0-SNAPSHOT`
    2. ✅ Image size: 543MB
    3. ✅ Build verified and image is ready to run

6. ✅ **Containerization Complete!**
